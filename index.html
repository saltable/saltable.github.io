<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-store">
  <title>ラクア Ver15</title>
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="apple-touch-icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRy-TqUoSIxdkbPuooctOiqi5gifXDO0oV1bQ&s"/>
  <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRy-TqUoSIxdkbPu0octOiqi5gifXDO0oV1bQ&s">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>

    body {
      margin: 0;
      font-family: sans-serif;
    }
    header {
      background-color: #333;
      color: white;
      display: flex;
      align-items: center;
      padding: 10px;
    }
    header img {
      height: 40px;
      margin-right: 10px;
      cursor: pointer;
    }
    header h1 {
      font-size: 1.2rem;
      margin: 0;
    }
    .menu-image {
      text-align: center;
      margin-bottom: 30px;
    }
    .menu-image img {
      max-width: 100%;
      height: auto;
    }
    .menu-header-images {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
    }
    .menu-header-images img {
      max-width: 45%;
      height: auto;
      border-radius: 8px;
    }
    #go-today {
      display: block;
      width: 90%;
      max-width: 400px;
      margin: 20px auto;
      padding: 1rem;
      font-size: 1.5rem;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 8px;
      text-align: center;
      transition: transform 0.2s ease, background-color 0.3s;
    }
    #go-today:active {
      transform: scale(0.96);
      background-color: #1976D2;
    }
    .button-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    .sub-button {
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }
    .sub-button:active {
      background-color: #388E3C;
    }
    input[type="checkbox"] {
      display: none;
    }
    .actions-menu {
      position: fixed;
      width: 60px;
      height: 60px;
      right: 15px;
      bottom: 15px;
    }
    .btn {
      background: #e74c3c;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .talk {
      color: red;
    }
    .btn--large {
      width: 60px;
      height: 60px;
      position: absolute;
      top: 0;
      left: 0;
    }
    .popup-flag {
      display: none;
    }

    .popup-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      z-index: 1002;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      width: 90%;
      max-width: 500px;
      box-sizing: border-box;
    }

    .popup-flag:checked + .popup-background {
      opacity: 1;
      visibility: visible;
    }

    .popup-flag:checked + .popup-background + .popup {
      opacity: 1;
      visibility: visible;
    }

    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      cursor: pointer;
      color: #333;
    }

    .popup .content {
      text-align: center;
    }

    .popup .content h3 {
      margin-top: 0;
      color: #4A6572;
      font-size: 1.8rem;
    }

    .popup .content h5 {
      color: #607D8B;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRy-TqUoSIxdkbPuooctOiqi5gifXDO0oV1bQ&s"></a>
  </header>

  <button id="go-today">出席する</button>

  <div class="button-row">
    <button class="sub-button" onclick="location.href='https://cit.manaba.jp/ct/home/'">manaba</button>
    <button class="sub-button" onclick="location.href='https://portal.it-chiba.ac.jp/uprx/up/pk/pky001/Pky00101.xhtml/'">CITportal</button>
  </div>

  <div class="menu-header-images" id="menuHeaderImages" style="display: none;"></div>
  <h id="imageUpdateNote" style="display: none;">画像タップで最新画像に更新</h>

  <h1>今週の食堂メニュー</h1>
  <div id="menu1" class="menu-image"></div>
  <div id="menu2" class="menu-image"></div>
  

  <input type="checkbox" class="popup-flag" id="eventPopupFlag">
  <label class="popup-background" for="eventPopupFlag"></label>
  

 

  <script>
    function getCurrentTimestamp() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const MM = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      const hh = String(now.getHours()).padStart(2, '0');
      const mm = String(now.getMinutes()).padStart(2, '0');
      const ss = String(now.getSeconds()).padStart(2, '0');
      return `${yyyy}${MM}${dd}${hh}${mm}${ss}`;
    }

    function createReloadableImage(baseUrl) {
      const img = document.createElement("img");
      const updateSrc = () => {
        img.src = `${baseUrl}${getCurrentTimestamp()}`;
      };
      updateSrc();
      img.alt = "食堂ヘッダー画像";
      img.style.cursor = "pointer";
      img.addEventListener("click", updateSrc);
      return img;
    }

    function shouldShowMenuHeaderImages() {
      const now = new Date();
      const day = now.getDay(); // 日曜:0
      const hour = now.getHours();
      return day !== 0 && hour >= 11 && hour < 14;
    }

    if (shouldShowMenuHeaderImages()) {
      const headerImageContainer = document.getElementById("menuHeaderImages");
      headerImageContainer.style.display = "flex";
      headerImageContainer.appendChild(createReloadableImage("https://www.cit-s.com/i_catch/dining/narashino1.jpg?"));
      headerImageContainer.appendChild(createReloadableImage("https://www.cit-s.com/i_catch/dining/narashino2.jpg?"));
      document.getElementById("imageUpdateNote").style.display = "block";
    }

    function getMenuURL(baseName) {
      const today = new Date();
      const day = today.getDay();
      const sunday = new Date(today);
      sunday.setDate(today.getDate() - day);
      const weekdays = [];
      for (let i = 1; i <= 5; i++) {
        const d = new Date(sunday);
        d.setDate(sunday.getDate() + i);
        weekdays.push(d);
      }
      const monthCounts = {};
      for (const d of weekdays) {
        const yyyymm = `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, '0')}`;
        monthCounts[yyyymm] = (monthCounts[yyyymm] || 0) + 1;
      }
      const sortedMonths = Object.keys(monthCounts).sort((a, b) => {
        if (monthCounts[a] === monthCounts[b]) return b.localeCompare(a);
        return monthCounts[b] - monthCounts[a];
      });
      const targetMonth = sortedMonths[0];
      const startDate = new Date(Number(targetMonth.slice(0, 4)), Number(targetMonth.slice(4)) - 1, 1);
      startDate.setDate(startDate.getDate() - startDate.getDay());
      let weekNumber = 0;
      const now = new Date();
      while (startDate <= now) {
        let hasWeekdayInTargetMonth = false;
        for (let i = 1; i <= 5; i++) {
          const d = new Date(startDate);
          d.setDate(startDate.getDate() + i);
          const yyyymm = `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, '0')}`;
          if (yyyymm === targetMonth) {
            hasWeekdayInTargetMonth = true;
            break;
          }
        }
        if (hasWeekdayInTargetMonth) {
          weekNumber++;
        }
        startDate.setDate(startDate.getDate() + 7);
      }
      return `https://www.cit-s.com/wp/wp-content/themes/cit/menu/${baseName}_${targetMonth}_${weekNumber}.png`;
    }

    const menu1 = document.createElement("img");
    menu1.src = getMenuURL("sd1");
    menu1.alt = "食堂メニュー1";
    document.getElementById("menu1").appendChild(menu1);

    const menu2 = document.createElement("img");
    menu2.src = getMenuURL("sd2");
    menu2.alt = "食堂メニュー2";
    document.getElementById("menu2").appendChild(menu2);

    document.getElementById("go-today").addEventListener("click", () => {
      const days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
      const today = new Date().getDay();
      const target = days[today];
      location.href = `${target}.html`;
    });

    document.addEventListener('DOMContentLoaded', () => {
        const popupFlag = document.getElementById('eventPopupFlag');
        if (!localStorage.getItem('eventPopupShown')) {
            popupFlag.checked = true;
            localStorage.setItem('eventPopupShown', 'true');
        }
    });
  </script>
</body>
</html>